// Generated by CoffeeScript 1.4.0

module.exports = function(subscribe, publish, edge, context) {
  subscribe('event:register:controller', function(primaryViewportID) {
    var id, _base;
    context.gimbal || (context.gimbal = {});
    (_base = context.gimbal).controllers || (_base.controllers = {});
    id = edge.localId();
    context.gimbal.controllers[id] = {
      edge: edge,
      primary: primaryViewportID,
      viewports: []
    };
    context.gimbal.controllers[id].viewports.push(primaryViewportID);
    return publish('event:register:controller:ok');
  });
  return subscribe('event:controller', function(payload) {
    var id, registeredViewports, send, viewportID, _i, _len, _results;
    console.log('RECEIVED: event:controller %s', JSON.stringify(payload));
    id = edge.localId();
    registeredViewports = context.gimbal.controllers[id].viewports;
    _results = [];
    for (_i = 0, _len = registeredViewports.length; _i < _len; _i++) {
      viewportID = registeredViewports[_i];
      send = context.gimbal.viewports[viewportID].getPublisher();
      _results.push(send(payload.event, payload.payload));
    }
    return _results;
  });
};
