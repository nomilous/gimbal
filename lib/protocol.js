// Generated by CoffeeScript 1.4.0
var os;

os = require('os');

module.exports = function(subscribe, publish, edge, context) {
  return subscribe('event:register:viewport', function(payload) {
    var details, iface, ifaces, url, _base, _i, _len, _ref;
    context.gimbal || (context.gimbal = {});
    (_base = context.gimbal).viewports || (_base.viewports = {});
    context.gimbal.viewports[edge.localId()] = edge;
    url = context.listen.server.url;
    if (url.match(/\/\/0\.0\.0\.0/)) {
      ifaces = os.networkInterfaces();
      for (iface in ifaces) {
        _ref = ifaces[iface];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          details = _ref[_i];
          if (details.internal) {
            continue;
          }
          if (details.family !== 'IPv4') {
            continue;
          }
          if (details.address.match(/^192\.168\./)) {
            continue;
          }
          url = url.replace('0.0.0.0', details.address);
        }
      }
    }
    return console.log("URL:", url);
  });
};
